<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Planicchio ğŸ±</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>

<style>
.hidden{display:none}
.pet{animation:float 2.5s ease-in-out infinite}
@keyframes float{
  0%{transform:translateY(0)}
  50%{transform:translateY(-12px)}
  100%{transform:translateY(0)}
}
</style>
</head>

<body class="bg-orange-50 text-gray-800">

<!-- ğŸ± PET -->
<div class="fixed bottom-4 right-4 text-center z-50">
  <div class="text-6xl pet cursor-pointer" onclick="meow()">ğŸ±</div>
  <div id="petText" class="bg-white p-2 rounded shadow text-sm">
    Ciao! ğŸ˜¸
  </div>
</div>

<!-- START -->
<div id="start" class="min-h-screen flex flex-col items-center justify-center">
  <div class="text-7xl pet mb-2">ğŸ±</div>
  <h1 class="text-4xl font-bold">PLANICCHIO</h1>
  <p id="chooseText" class="mb-4">Scegli il tuo corso</p>

  <div class="grid grid-cols-2 gap-3">
    <button onclick="startCourse('it-en')" class="btn">ğŸ‡®ğŸ‡¹ â†’ ğŸ‡¬ğŸ‡§ EN</button>
    <button onclick="startCourse('it-pt')" class="btn">ğŸ‡®ğŸ‡¹ â†’ ğŸ‡§ğŸ‡· PT</button>
    <button onclick="startCourse('pt-it')" class="btn">ğŸ‡§ğŸ‡· â†’ ğŸ‡®ğŸ‡¹ IT</button>
    <button onclick="startCourse('pt-en')" class="btn">ğŸ‡§ğŸ‡· â†’ ğŸ‡¬ğŸ‡§ EN</button>
    <button onclick="startCourse('en-it')" class="btn">ğŸ‡¬ğŸ‡§ â†’ ğŸ‡®ğŸ‡¹ IT</button>
    <button onclick="startCourse('en-pt')" class="btn">ğŸ‡¬ğŸ‡§ â†’ ğŸ‡§ğŸ‡· PT</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<div class="p-4 bg-white shadow">
  <b>A1 â€“ Esploratore</b>
  <div class="w-40 bg-gray-300 rounded">
    <div id="progress" class="bg-green-500 h-2 rounded" style="width:20%"></div>
  </div>
</div>

<div class="flex gap-2 p-2 bg-orange-100 text-sm">
  <button onclick="show('home')">ğŸ  Home</button>
  <button onclick="show('ex')">âœï¸ Esercizi</button>
</div>

<div id="home" class="p-4">
  <p>Missioni giornaliere in arrivo ğŸ¾</p>
</div>

<div id="ex" class="p-4 hidden">
  <p id="q">Caricamento...</p>
  <button id="b1" class="btn"></button>
  <button id="b2" class="btn"></button>
</div>

</div>

<script>
let course="it-en"
let progress=20
let exercises=[]
let current=0

const SHEET_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vT6-Ah6rq3hnBihlxVAzmsTD8rEF1rbGJu3__sBgm-DDyFWE_D7sxgJx3I3s55uiNl-qvP2x2wh0UD9/pub?gid=927577129&single=true&output=csv"

// CSV robusto (vÃ­rgula OU ponto e vÃ­rgula)
function parseCSV(text){
  const sep = text.includes(";") ? ";" : ","
  const rows = text.trim().split("\n").map(r=>r.split(sep))
  const headers = rows.shift().map(h=>h.trim())
  return rows.map(r=>{
    let o={}
    headers.forEach((h,i)=>{
      o[h]= (r[i]||"").trim()
    })
    return o
  })
}

async function loadExercises(){
  const res = await fetch(SHEET_URL)
  const text = await res.text()
  const data = parseCSV(text)
  exercises = data.filter(e=>e.course === course)
  showExercise()
}

function showExercise(){
  if(!exercises.length){
    q.innerText="âš ï¸ Nessun esercizio trovato per questo corso"
    b1.style.display="none"
    b2.style.display="none"
    return
  }
  const e = exercises[current]
  q.innerText = e.question
  b1.innerText = e.option1
  b2.innerText = e.option2
  b1.onclick = ()=>check(e.option1, e.correct)
  b2.onclick = ()=>check(e.option2, e.correct)
}

function check(ans, correct){
  if(ans === correct){
    progress += 10
    pet("Bravo! ğŸ˜»")
  } else {
    pet("Ops ğŸ˜¿")
  }
  document.getElementById("progress").style.width = progress + "%"
  current = (current + 1) % exercises.length
  setTimeout(showExercise, 500)
}

function startCourse(c){
  course = c
  start.classList.add("hidden")
  app.classList.remove("hidden")
  loadExercises()
}

function show(id){
  ["home","ex"].forEach(x=>document.getElementById(x).classList.add("hidden"))
  document.getElementById(id).classList.remove("hidden")
}

function pet(t){ petText.innerText=t }
function meow(){ pet("Miao ğŸ˜¸ Continua!") }
</script>

<style>
.btn{
  background:#fb923c;
  color:white;
  padding:10px;
  border-radius:14px;
  margin:6px 0;
  width:100%;
}
</style>

</body>
</html>
