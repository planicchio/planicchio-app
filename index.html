<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Planicchio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #FFF5EB; font-family: sans-serif; margin: 0; padding: 0; }
        .aba { display: none; padding: 20px; padding-bottom: 100px; }
        .aba-ativa { display: block; }
        .nav-fixa { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px; border-top: 2px solid #FFEDD5; }
        .card { background: white; border-radius: 20px; padding: 20px; border: 2px solid #FF8C00; margin-bottom: 15px; }
        .btn-check { display: flex; align-items: center; gap: 10px; background: white; padding: 12px; border-radius: 15px; border: 1px solid #FFEDD5; margin-bottom: 8px; width: 100%; font-weight: bold; font-size: 13px; }
        .splash { position: fixed; inset: 0; background: #FF8C00; z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="splash" class="splash">
        <h1 class="text-4xl font-black mb-4">PLANICCHIO üê±</h1>
        <p class="mb-6 font-bold">SCEGLI IL TUO CORSO</p>
        <div class="flex flex-col gap-3 w-64">
            <button onclick="iniciar('it-en')" class="bg-yellow-400 text-orange-900 font-black py-4 rounded-xl shadow-lg">ITALIANO ‚ûî ENGLISH</button>
            <button onclick="iniciar('it-pt')" class="bg-white text-orange-600 font-bold py-3 rounded-xl">ITALIANO ‚ûî PORTOGHESE</button>
            <button onclick="iniciar('pt-it')" class="bg-white text-orange-600 font-bold py-3 rounded-xl">PORTUGU√äS ‚ûî ITALIANO</button>
        </div>
    </div>

    <div id="app" class="hidden">
        <header class="p-4 bg-white border-b-2 border-orange-100 flex justify-between items-center">
            <b class="text-orange-600 text-xs uppercase">Apprendista üê£</b>
            <b class="text-orange-600 text-xs">LVL <span id="lvl">1</span></b>
        </header>

        <div id="home" class="aba aba-ativa">
            <h3 class="text-orange-600 font-black text-xs mb-3 uppercase">Missioni Diarie</h3>
            <div class="btn-check"><input type="checkbox" onchange="addXP(10)"> <span>Fare il Quiz</span></div>
            <div class="btn-check"><input type="checkbox" onchange="addXP(10)"> <span>Ascoltare Pronuncia</span></div>
            
            <div class="card text-center mt-6">
                <p id="pergunta" class="font-bold text-lg mb-6">Caricamento...</p>
                <div id="opcoes" class="flex flex-col gap-2"></div>
                <button onclick="ouvir()" class="mt-6 text-orange-400 font-black text-[10px] uppercase tracking-widest">üîä ASCOLTA</button>
            </div>
        </div>

        <div id="dic" class="aba">
            <h2 class="text-2xl font-black text-orange-600 mb-4 uppercase">Dizionario</h2>
            <div id="lista-dic"></div>
        </div>

        <div id="perfil" class="aba text-center">
            <div class="text-6xl mb-4">üê±</div>
            <input type="text" id="nome-user" class="text-center font-black text-xl border-b-2 border-orange-200 w-full mb-6 bg-transparent outline-none" placeholder="Il tuo nome">
            
            <div class="text-left bg-white p-4 rounded-2xl border-2 border-blue-100">
                <h3 class="text-blue-500 font-black text-[10px] mb-3">MISSIONI SETTIMANALI</h3>
                <div class="btn-check"><input type="checkbox"> <span>Livello 5</span></div>
                <div class="btn-check"><input type="checkbox"> <span>7 Giorni di fila</span></div>
                <div class="btn-check"><input type="checkbox"> <span>Invita un Amico</span></div>
            </div>
            <button onclick="location.reload()" class="mt-6 text-gray-400 font-bold text-xs uppercase">Cambia Corso</button>
        </div>

        <nav class="nav-fixa">
            <button onclick="mudarAba('home')" class="text-orange-600 font-black text-[10px]">üè† HOME</button>
            <button onclick="mudarAba('dic')" class="text-orange-600 font-black text-[10px]">üìñ DIZ</button>
            <button onclick="mudarAba('perfil')" class="text-orange-600 font-black text-[10px]">üë§ PROFILO</button>
        </nav>
    </div>

    <script>
        const URL_QUIZ = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT6-Ah6rq3hnBihlxVAzmsTD8rEF1rbGJu3__sBgm-DDyFWE_D7sxgJx3I3s55uiNl-qvP2x2wh0UD9/pub?gid=633031910&single=true&output=csv';
        const URL_DIC = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT6-Ah6rq3hnBihlxVAzmsTD8rEF1rbGJu3__sBgm-DDyFWE_D7sxgJx3I3s55uiNl-qvP2x2wh0UD9/pub?gid=541320303&single=true&output=csv';

        let curso = "";
        let xp = 0;
        let listaQuiz = [];

        function iniciar(id) {
            curso = id;
            document.getElementById('splash').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            carregarDados();
        }

        async function carregarDados() {
            try {
                const [resQ, resD] = await Promise.all([fetch(URL_QUIZ), fetch(URL_DIC)]);
                const txtQ = await resQ.text();
                const txtD = await resD.text();

                // Processar Quiz
                listaQuiz = txtQ.split('\n').slice(1).map(linha => {
                    const c = linha.split(',');
                    return { q: c[1], a: c[2], b: c[3], c: c[4], ok: c[5]?.trim().toLowerCase() };
                }).filter(x => x.q);
                showQuiz();

                // Processar Dicion√°rio
                const dicBox = document.getElementById('lista-dic');
                txtD.split('\n').slice(1).forEach(linha => {
                    const c = linha.split(',');
                    if(!c[2]) return;
                    const div = document.createElement('div');
                    div.className = "card";
                    div.innerHTML = `
                        <div class="flex justify-between font-black text-orange-600"><span>${c[2]}</span> <button onclick="fala('${c[2]}')">üîä</button></div>
                        <div class="text-[10px] italic text-gray-400">${c[3]}</div>
                        <div class="font-bold text-sm mt-1">${c[4]}</div>
                        <div class="mt-2 text-xs text-orange-800 bg-orange-50 p-2 rounded">Esempio: ${c[5] || '---'}</div>
                    `;
                    dicBox.appendChild(div);
                });
            } catch (e) { document.getElementById('pergunta').innerText = "Errore di connessione."; }
        }

        function showQuiz() {
            const item = listaQuiz[Math.floor(Math.random() * listaQuiz.length)];
            document.getElementById('pergunta').innerText = item.q;
            const box = document.getElementById('opcoes');
            box.innerHTML = "";
            ['a', 'b', 'c'].forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "btn-check justify-center border-2 border-orange-100";
                btn.innerText = item[opt];
                btn.onclick = () => {
                    if(opt === item.ok) { alert("Bravissimo! +20XP"); addXP(20); showQuiz(); }
                    else { btn.style.borderColor = "red"; }
                };
                box.appendChild(btn);
            });
        }

        function mudarAba(id) {
            document.querySelectorAll('.aba').forEach(a => a.classList.remove('aba-ativa'));
            document.getElementById(id).classList.add('aba-ativa');
        }

        function addXP(v) { xp += v; document.getElementById('lvl').innerText = Math.floor(xp/100) + 1; }

        function fala(t) {
            const u = new SpeechSynthesisUtterance(t);
            u.lang = curso.split('-')[1] === 'en' ? 'en-US' : 'it-IT';
            speechSynthesis.speak(u);
        }
        function ouvir() { fala(document.getElementById('pergunta').innerText); }
    </script>
</body>
</html>
