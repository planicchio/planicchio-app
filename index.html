<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Planicchio ğŸ±</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>

<style>
.hidden{display:none}
.pet{animation:float 2.5s ease-in-out infinite}
@keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}
</style>
</head>

<body class="bg-orange-50 text-gray-800">

<!-- ğŸ± PET -->
<div class="fixed bottom-4 right-4 text-center z-50">
  <div class="text-6xl pet cursor-pointer" onclick="meow()">ğŸ±</div>
  <div id="petText" class="bg-white p-2 rounded shadow text-sm">
    Ciao! Continuiamo ğŸ˜¸
  </div>
</div>

<!-- ğŸ†˜ SOS -->
<a href="https://wa.me/393716755981" target="_blank"
class="fixed bottom-4 left-4 bg-green-500 text-white px-4 py-2 rounded-full z-50">
ğŸ†˜ SOS Planicchio
</a>

<!-- ========== START ========== -->
<div id="start" class="min-h-screen flex flex-col items-center justify-center">
  <div class="text-7xl pet mb-2">ğŸ±</div>
  <h1 class="text-4xl font-bold">PLANICCHIO</h1>
  <p id="chooseText" class="mb-4">Scegli il tuo corso</p>

  <div class="grid grid-cols-2 gap-3">
    <button onclick="startCourse('it-en')" class="btn">ğŸ‡®ğŸ‡¹ â†’ ENG</button>
    <button onclick="startCourse('it-pt')" class="btn">ğŸ‡®ğŸ‡¹ â†’ ğŸ‡§ğŸ‡·</button>
    <button onclick="startCourse('pt-it')" class="btn">ğŸ‡§ğŸ‡· â†’ ğŸ‡®ğŸ‡¹</button>
    <button onclick="startCourse('pt-en')" class="btn">ğŸ‡§ğŸ‡· â†’ ENG</button>
    <button onclick="startCourse('en-it')" class="btn">ENG â†’ ğŸ‡®ğŸ‡¹</button>
    <button onclick="startCourse('en-pt')" class="btn">ENG â†’ ğŸ‡§ğŸ‡·</button>
  </div>

  <div class="mt-4">
    <button onclick="setLang('it')">IT</button>
    <button onclick="setLang('en')">EN</button>
    <button onclick="setLang('pt')">PT-BR</button>
  </div>
</div>

<!-- ========== APP ========== -->
<div id="app" class="hidden">

<div class="p-4 bg-white shadow">
  <b id="levelText">A1 â€“ Esploratore</b>
  <div class="w-40 bg-gray-300 rounded">
    <div id="progress" class="bg-green-500 h-2 rounded" style="width:20%"></div>
  </div>
</div>

<div class="flex gap-2 p-2 bg-orange-100 text-sm">
  <button onclick="show('home')">ğŸ  Home</button>
  <button onclick="show('ex')">âœï¸ Esercizi</button>
  <button onclick="show('community')">ğŸ’¬ ComunitÃ </button>
  <button onclick="show('profile')">ğŸ‘¤ Profilo</button>
</div>

<!-- HOME -->
<div id="home" class="p-4">
  <h2 id="dailyTitle" class="font-bold">Missioni giornaliere</h2>
  <ul>
    <li>âœ” 10 parole</li>
    <li>âœ” 1 esercizio</li>
    <li>âœ” 1 gioco</li>
  </ul>
</div>

<!-- ESERCIZI -->
<div id="ex" class="p-4 hidden">
  <p id="q">Caricamento esercizio...</p>
  <button id="b1" class="btn"></button>
  <button id="b2" class="btn"></button>
</div>

<!-- COMMUNITY -->
<div id="community" class="p-4 hidden">
  <input id="msg" class="border p-2 w-full" placeholder="Scrivi...">
  <button onclick="send()" class="btn mt-2">Invia</button>
  <div id="msgs" class="mt-2 text-sm"></div>
</div>

<!-- PROFILO -->
<div id="profile" class="p-4 hidden">
  <input id="name" class="border p-2" placeholder="Il tuo nome">
  <button onclick="saveName()" class="btn">Salva</button>
  <p id="saved"></p>
</div>

</div>

<script>
let lang="it"
let course="it-en"
let progress=Number(localStorage.getItem("progress"))||20
let exercises=[]
let current=0

const SHEET_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vT6-Ah6rq3hnBihlxVAzmsTD8rEF1rbGJu3__sBgm-DDyFWE_D7sxgJx3I3s55uiNl-qvP2x2wh0UD9/pub?gid=927577129&single=true&output=csv"

const t={
  it:{choose:"Scegli il tuo corso",daily:"Missioni giornaliere"},
  en:{choose:"Choose your course",daily:"Daily missions"},
  pt:{choose:"Escolha seu curso",daily:"MissÃµes diÃ¡rias"}
}

function parseCSV(text){
  const rows=text.trim().split("\n").map(r=>r.split(","))
  const headers=rows.shift()
  return rows.map(r=>{
    let o={}
    headers.forEach((h,i)=>o[h]=r[i])
    return o
  })
}

async function loadExercises(){
  const res=await fetch(SHEET_URL)
  const text=await res.text()
  const data=parseCSV(text)
  exercises=data.filter(e=>e.course===course)
  showExercise()
}

function showExercise(){
  if(!exercises.length){
    q.innerText="Nessun esercizio trovato"
    return
  }
  const e=exercises[current]
  q.innerText=e.question
  b1.innerText=e.option1
  b2.innerText=e.option2
  b1.onclick=()=>check(e.option1,e.correct)
  b2.onclick=()=>check(e.option2,e.correct)
}

function check(ans,correct){
  if(ans===correct){
    progress+=10
    pet("Bravo! ğŸ˜»")
  }else{
    pet("Ops ğŸ˜¿")
  }
  localStorage.setItem("progress",progress)
  progressBar()
  current=(current+1)%exercises.length
  setTimeout(showExercise,500)
}

function progressBar(){
  document.getElementById("progress").style.width=progress+"%"
}

function startCourse(c){
  course=c
  localStorage.setItem("course",c)
  start.classList.add("hidden")
  app.classList.remove("hidden")
  loadExercises()
}

function show(id){
  ["home","ex","community","profile"].forEach(x=>document.getElementById(x).classList.add("hidden"))
  document.getElementById(id).classList.remove("hidden")
}

function setLang(l){
  lang=l
  chooseText.innerText=t[l].choose
  dailyTitle.innerText=t[l].daily
}

function send(){
  msgs.innerHTML+=`<div>ğŸ‘¤ ${msg.value}</div>`
  msg.value=""
}

function saveName(){
  localStorage.setItem("name",name.value)
  saved.innerText="Salvato!"
}

function pet(t){ petText.innerText=t }
function meow(){ pet("Miao ğŸ˜¸ Continua!") }
</script>

<style>
.btn{
  background:#fb923c;
  color:white;
  padding:8px 12px;
  border-radius:12px;
  margin:6px 0;
  display:block;
}
</style>

</body>
</html>
